<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VividMedi - Request a Medical Certificate</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f9ff;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin: 0;
      min-height: 100vh;
    }

    header {
      text-align: center;
      margin: 30px 0 10px 0;
    }

    header h1 {
      color: #005bab;
      font-size: 2.4rem;
      margin: 0;
    }

    header p {
      color: #555;
      margin: 0;
      font-size: 1rem;
    }

    .form-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 480px;
      padding: 30px;
      margin-top: 20px;
    }

    #progressBar {
      width: 100%;
      height: 8px;
      background: #ddd;
      border-radius: 5px;
      margin-bottom: 25px;
      overflow: hidden;
    }

    #progress {
      width: 25%;
      height: 100%;
      background: #005bab;
      transition: width 0.3s ease-in-out;
    }

    input, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
    }

    button {
      background: #005bab;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #0072d0;
    }

    label {
      display: block;
      text-align: left;
      margin: 10px 0;
    }

    .note {
      font-size: 0.85rem;
      color: #666;
    }

    .button-row {
      display: flex;
      justify-content: space-between;
    }

    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
    }

    footer {
      margin-top: 20px;
      font-size: 0.85rem;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>

  <header>
    <h1>VividMedi</h1>
    <p>Request a Medical Certificate Online</p>
  </header>

  <div class="form-container">
    <div id="progressBar"><div id="progress"></div></div>

    <form id="multiStepForm">
      <!-- STEP 1 -->
      <div class="form-step active">
        <h2>Step 1: Patient Information</h2>
        <input type="text" id="firstName" placeholder="First Name" required>
        <input type="text" id="lastName" placeholder="Last Name" required>
        <input type="email" id="email" placeholder="Email Address" required>
        <button type="button" class="next-btn">Continue</button>
      </div>

      <!-- STEP 2 -->
      <div class="form-step">
        <h2>Step 2: Reason for Certificate</h2>
        <label><input type="radio" name="reason" value="Sick Leave" required> Sick Leave</label>
        <label><input type="radio" name="reason" value="Carer’s Leave"> Carer’s Leave</label>
        <label><input type="radio" name="reason" value="Other"> Other</label>
        <input type="text" id="otherReason" placeholder="If other, describe reason..." style="display:none;">
        <div class="button-row">
          <button type="button" class="prev-btn">Back</button>
          <button type="button" class="next-btn">Continue</button>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="form-step">
        <h2>Step 3: Leave Duration</h2>
        <label>From:</label>
        <input type="date" id="fromDate" required>
        <label>To:</label>
        <input type="date" id="toDate" required>
        <p class="note">You can only request certificates for the past 7 days and up to 5 days total.</p>
        <div class="button-row">
          <button type="button" class="prev-btn">Back</button>
          <button type="button" class="next-btn">Continue</button>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="form-step">
        <h2>Step 4: Confirm & Submit</h2>
        <div id="summary"></div>
        <div class="button-row">
          <button type="button" class="prev-btn">Back</button>
          <button type="submit" class="submit-btn">Submit Request</button>
        </div>
      </div>
    </form>
  </div>

  <footer>
    <p>© 2025 VividMedi Health | Secure Telehealth Certificates</p>
  </footer>

  <script>
    const form = document.getElementById("multiStepForm");
    const steps = document.querySelectorAll(".form-step");
    const nextBtns = document.querySelectorAll(".next-btn");
    const prevBtns = document.querySelectorAll(".prev-btn");
    const progress = document.getElementById("progress");

    let currentStep = 0;

    function updateProgressBar() {
      const progressPercent = ((currentStep + 1) / steps.length) * 100;
      progress.style.width = `${progressPercent}%`;
    }

    function showStep() {
      steps.forEach((step, index) => {
        step.classList.toggle("active", index === currentStep);
      });
      updateProgressBar();
    }

    nextBtns.forEach(btn => btn.addEventListener("click", () => {
      if (currentStep < steps.length - 1) currentStep++;
      const other = document.getElementById("otherReason");
      const otherRadio = document.querySelector("input[value='Other']");
      other.style.display = otherRadio.checked ? "block" : "none";
      showStep();
    }));

    prevBtns.forEach(btn => btn.addEventListener("click", () => {
      if (currentStep > 0) currentStep--;
      showStep();
    }));

    form.addEventListener("change", () => {
      const summary = document.getElementById("summary");
      summary.innerHTML = `
        <strong>Name:</strong> ${form.firstName.value} ${form.lastName.value}<br>
        <strong>Email:</strong> ${form.email.value}<br>
        <strong>Reason:</strong> ${form.reason.value}<br>
        <strong>Dates:</strong> ${form.fromDate.value} → ${form.toDate.value}
      `;
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        firstName: form.firstName.value,
        lastName: form.lastName.value,
        email: form.email.value,
        reason: form.reason.value === "Other" ? document.getElementById("otherReason").value : form.reason.value,
        fromDate: form.fromDate.value,
        toDate: form.toDate.value
      };

      try {
        const res = await fetch("https://vividmedi-backend.onrender.com/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const json = await res.json();
        alert(json.message || "✅ Request submitted successfully!");
      } catch (err) {
        console.error("❌ Submission failed:", err);
        alert("Something went wrong. Please try again later.");
      }
    });

    showStep();
  </script>

</body>
</html>
